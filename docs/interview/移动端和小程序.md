# 移动端和小程序

## 点击穿透现象及解决办法

- **现象**：点击穿透的现象比如说点击mask上的关闭按钮，mask消失后发现触发了按钮下面元素的点击事件或者是跳转到另一个页面
- **解决方案**：只用touch事件，touchstart、touchend、tap轻触事件；第二种方式是只用click事件，因为单击会有300ms的延迟，但是页面内任何一个自定义交互都将增加300ms延迟；第三种方式是tap后延迟350ms再隐藏mask，但是体验感差了一点

## 页面适配

- 流式布局，使用百分比布局，非固定像素
- 使用vw和vh
- rem单位配合flexible.js使用 

## 小程序页面生命周期

- 应用级别：Page()中触发
  - onLaunch：小程序启启动时
  - onShow：小程序前台运行时
  - onHide：小程序后台运行时
  - onError：执行错误时
  - onPageNotFount：冷启动（如扫码）打开小程序的页面不存在时
- 页面级别：
  - onLoad：页面加载时触发。一个页面只会调用一次，可以在onLoad的参数中获取打开当前页面路径的参数
  - onShow：页面显示/切入前台时触发（返回、tabBar切换、前台运行）
  - onReady：页面初次渲染完毕，相当于vue的mounted。一个页面只会调用一次，代表页面已经准备妥当，可以可视图层进行交互
  - onHide：页面隐藏/切入后台时触发（跳转、tabBar切换、后台运行）
  - onUnload：页面卸载时触发。如redirectTo 或 navigateBack 到其他页面时

## 上拉加载和下拉刷新

### 上拉加载

1. 使用 scroll-view 组件，该组件中有一个 `@scrolltolower` 事件，表示滚动到底部/右边，触发 `scrolltolower` 事件，可以在事件中进行处理
2. onReachBottom生命周期钩子函数，页面滚动到底部的事件（不是scroll-view滚到底）

`onReachBottom`使用注意 可在pages.json里定义具体页面底部的触发距离[onReachBottomDistance](https://zh.uniapp.dcloud.io/collocation/pages#globalstyle)，比如设为50，那么滚动页面到距离底部50px时，就会触发onReachBottom事件。

### 下拉刷新

在 js 中定义 onPullDownRefresh 处理函数（和onLoad等生命周期函数同级），监听该页面用户下拉刷新事件。

- 需要在 `pages.json` 里，找到的当前页面的pages节点，并在 `style` 选项中开启 `enablePullDownRefresh`。
- 当处理完数据刷新后，`uni.stopPullDownRefresh` 可以停止当前页面的下拉刷新