# 计算机网络

## HTTP1到3

### http1

缺点：

- 队头阻塞
- 默认是短链接

短链接：HTTP 协议的初始版本中，每进行一次 HTTP 通信就要断开一次 TCP 连接。

### http1.1

引入了持久连接（HTTP Persistent Connections），即 TCP 连接默认不关闭，可以被多个请求复用，不用声明 `Connection: keep-alive`。

持久连接的好处在于减少了 TCP 连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载。

目前，对于同一个域名，大多数浏览器允许同时建立6个持久连接。

缺陷：

虽然 HTTP 1.1 版允许复用 TCP 连接，但是同一个 TCP 连接里面，所有的数据通信是按次序进行的。服务器只有处理完一个回应，才会进行下一个回应。要是前面的回应特别慢，后面就会有许多请求排队等着。这称为"队头堵塞"（Head-of-line blocking）。

### http2

- HTTP/2 复用 TCP 连接，**在一个连接里，客户端和浏览器都可以同时发送多个请求或回应，而且不用按照顺序一一对应**，这样就避免了"队头堵塞"。
- HTTP/2 的数据包是不按顺序发送的，同一个连接里面连续的数据包，可能属于不同的回应。因此，必须要对数据包做标记，指出它属于哪个回应。
- HTTP/2 引入了头信息压缩机制（header compression）。

- HTTP/2 允许服务器未经请求，主动向客户端发送资源，这叫做服务器推送（server push）。

缺点：

1. TCP以及TCP+TLS建立连接的延迟（握手延迟）
2. http2.0中TCP的**队头阻塞依然没有彻底解决**

### http3

制定一种**基于UDP的低时延的互联网传输层协议**

## TCP的三次握手和四次挥手

三次握手（Three-way Handshake）其实就是指建立一个TCP连接时，需要客户端和服务器总共发送3个包。进行三次握手的主要作用就是为了确认双方的接收能力和发送能力是否正常、指定自己的初始化序列号为后面的可靠性传送做准备。实质上其实就是连接服务器指定端口，建立TCP连接，并同步连接双方的序列号和确认号，交换TCP窗口大小信息。

TCP 使用四次挥手的原因是因为 TCP 的连接是全双工的，所以需要双方分别释放到对方的连接，单独一方的连接释放，只代 表不能再向对方发送数据，连接处于的是半释放的状态。

最后一次挥手中，客户端会等待一段时间再关闭的原因，是为了防止发送给服务器的确认报文段丢失或者出错，从而导致服务器 端不能正常关闭。

## TCP和UDP的区别

TCP协议是⾯向流的协议，UDP是⾯向消息的协议。UDP段都是⼀条消息，应⽤程序必须以消息为单位提取数据，不能⼀次提取任意字节的数据 

TCP会粘包，UDP不会粘包

|              | UDP                                        | TCP                                                  |
| ------------ | ------------------------------------------ | ---------------------------------------------------- |
| 是否连接     | 无连接                                     | 面向连接                                             |
| 是否可靠     | 不可靠传输，不使用流量控制和拥塞控制       | 可靠传输（数据顺序和正确性），使用流量控制和拥塞控制 |
| 连接对象个数 | 支持一对一，一对多，多对一和多对多交互通信 | 只能是一对一通信                                     |
| 传输方式     | 面向报文                                   | 面向字节流                                           |
| 首部开销     | 首部开销小，仅8字节                        | 首部最小20字节，最大60字节                           |
| 适用场景     | 适用于实时应用，例如视频会议、直播         | 适用于要求可靠传输的应用，例如文件传输               |

## UDP协议的缺点

- 不保证消息交付：不确认，不重传，无超时
- 不保证交付顺序：不设置包序号，不重排，不会发生队首阻塞
- 不跟踪连接状态：不必建立连接或重启状态机
- 不进行拥塞控制：不内置客户端或网络反馈机制

## 浏览器中输入网址按下回车会发生什么

1. 解析URL
2. 缓存判断
3. DNS解析
4. 获取MAC地址
5. TCP三次握手
6. HTTPS握手
7. 返回数据
8. 页面渲染
9. TCP四次挥手